{% for clergy in clergy_list %}
<tr class="clergy-row {% if clergy.is_deleted %}deleted-record{% endif %}" data-clergy-id="{{ clergy.id }}" {% if user and (user.can_edit_clergy() or user.can_comment()) %}style="cursor: pointer;"{% endif %}>
    <td class="name-col">
        <div class="d-flex align-items-center">
            <!-- Clergy Picture -->
            <div class="clergy-picture-container me-2">
                {% if clergy.image_url %}
                    <img src="{{ clergy.image_url }}" alt="{{ clergy.display_name }}" class="clergy-picture" />
                {% else %}
                    <div class="clergy-picture-placeholder">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="16" cy="16" r="16" fill="#e9ecef"/>
                            <circle cx="16" cy="12" r="4" fill="#6c757d"/>
                            <path d="M8 24c0-4.4 3.6-8 8-8s8 3.6 8 8" fill="#6c757d"/>
                        </svg>
                    </div>
                {% endif %}
            </div>
            
            <!-- Name and Tags -->
            <div class="flex-grow-1">
                <strong>{{ clergy.display_name }}</strong>
                
                <!-- Deleted Record Indicator -->
                {% if clergy.is_deleted %}
                    <span class="badge bg-danger ms-1" title="This record has been marked as deleted">
                        <i class="fas fa-trash"></i> Deleted
                    </span>
                {% endif %}
                
                <!-- Missing Data Tags -->
                {% if not clergy.ordinations %}
                    <span class="badge bg-warning ms-1" title="Missing ordination date">No Ord Date</span>
                {% endif %}
                {% if clergy.ordinations and not clergy.ordinations[0].ordaining_bishop %}
                    <span class="badge bg-warning ms-1" title="Missing ordaining bishop">No Ordainer</span>
                {% endif %}
                {% if clergy.rank and clergy.rank.lower() in ['bishop', 'pope', 'archbishop', 'cardinal', 'patriarch'] and not clergy.consecrations %}
                    <span class="badge bg-warning ms-1" title="Missing consecration date">No Cons Date</span>
                {% endif %}
                {% if clergy.rank and clergy.rank.lower() in ['bishop', 'pope', 'archbishop', 'cardinal', 'patriarch'] and clergy.consecrations and not clergy.consecrations[0].consecrator %}
                    <span class="badge bg-warning ms-1" title="Missing consecrator">No Consecrator</span>
                {% endif %}
                
                <!-- Special Status Flags -->
                {% for ordination in clergy.ordinations %}
                    {% if ordination.is_sub_conditione %}
                        <span class="badge bg-info ms-1" title="Ordination sub conditione">Sub Cond</span>
                    {% endif %}
                    {% if ordination.is_doubtful %}
                        <span class="badge bg-warning ms-1" title="Doubtful ordination">Doubtful</span>
                    {% endif %}
                    {% if ordination.is_invalid %}
                        <span class="badge bg-danger ms-1" title="Invalid ordination">Invalid</span>
                    {% endif %}
                {% endfor %}
                
                {% for consecration in clergy.consecrations %}
                    {% if consecration.is_sub_conditione %}
                        <span class="badge bg-info ms-1" title="Consecration sub conditione">Sub Cond</span>
                    {% endif %}
                    {% if consecration.is_doubtful %}
                        <span class="badge bg-warning ms-1" title="Doubtful consecration">Doubtful</span>
                    {% endif %}
                    {% if consecration.is_invalid %}
                        <span class="badge bg-danger ms-1" title="Invalid consecration">Invalid</span>
                    {% endif %}
                {% endfor %}
                
                <!-- Organization Badge -->
                {% if clergy.organization and org_abbreviation_map.get(clergy.organization) %}
                    {% set org_color = org_color_map.get(clergy.organization, '#27ae60') %}
                    {% set text_color = 'white' if getContrastColor(org_color) == 'white' else 'black' %}
                    {% set border_style = getBorderStyle(org_color) %}
                    <span class="badge ms-2" style="background-color: {{ org_color }}; color: {{ text_color }}; {{ border_style }}; font-size: 0.85em; vertical-align: middle;">{{ org_abbreviation_map.get(clergy.organization) }}</span>
                {% endif %}
                
                <!-- Comments Badge -->
                {% if user and user.can_comment() %}
                    {% set unresolved_count = 0 %}
                    {% for comment in clergy.comments %}
                        {% if not comment.is_resolved %}
                            {% set unresolved_count = unresolved_count + 1 %}
                        {% endif %}
                    {% endfor %}
                    {% if unresolved_count > 0 %}
                        <span class="badge bg-info ms-1" title="Has unresolved comments">
                            <i class="fas fa-comment"></i> {{ unresolved_count }}
                        </span>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </td>
    <td class="truncate-cell">
        {% if clergy.ordinations %}
            {% for ordination in clergy.ordinations %}
                {{ ordination.date.strftime('%Y-%m-%d') }}{% if ordination.ordaining_bishop %} - {{ ordination.ordaining_bishop.name }}{% endif %}{% if not loop.last %}<br>{% endif %}
            {% endfor %}
        {% else %}
            -
        {% endif %}
    </td>
    <td class="truncate-cell">
        {% if clergy.consecrations %}
            {% for consecration in clergy.consecrations %}
                {{ consecration.date.strftime('%Y-%m-%d') }}{% if consecration.consecrator %} - {{ consecration.consecrator.name }}{% endif %}{% if not loop.last %}<br>{% endif %}
            {% endfor %}
        {% else %}
            -
        {% endif %}
    </td>
</tr>
{% endfor %} 