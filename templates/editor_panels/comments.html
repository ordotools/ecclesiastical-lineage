<!-- Comments Panel Content -->
<div style="padding: 1em;">
    <div style="margin-bottom: 1em; display: flex; justify-content: between; align-items: center;">
        <h6 style="margin: 0; color: rgba(255, 255, 255, 0.9); font-size: 0.95em;">Recent Comments</h6>
        <div style="font-size: 0.8em; color: rgba(255, 255, 255, 0.6);">
            {{ comments.items | length }} of {{ comments.total }} comments
        </div>
    </div>

    {% if comments.items %}
    <div style="max-height: 200px; overflow-y: auto;">
        {% for comment in comments.items %}
        <div style="padding: 0.75em; margin-bottom: 0.5em; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 4px; font-size: 0.85em;">
            <!-- Comment Header -->
            <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 0.5em;">
                <div style="flex: 1;">
                    <div style="color: rgba(255, 255, 255, 0.9); font-weight: 500; margin-bottom: 0.25em;">
                        {% if comment.clergy %}
                        <i class="fas fa-user" style="margin-right: 0.5em; color: rgba(255, 255, 255, 0.5);"></i>
                        <span>{{ comment.clergy.name }}</span>
                        {% if comment.field_name %}
                        <span style="color: rgba(255, 255, 255, 0.6); font-weight: normal; margin-left: 0.5em;">
                            ({{ comment.field_label or comment.field_name }})
                        </span>
                        {% endif %}
                        {% else %}
                        <span style="color: rgba(255, 255, 255, 0.7);">General Comment</span>
                        {% endif %}
                    </div>
                    <div style="color: rgba(255, 255, 255, 0.5); font-size: 0.8em;">
                        by {{ comment.user.username if comment.user else 'Unknown' }} â€¢ 
                        <span title="{{ comment.created_at.strftime('%Y-%m-%d %H:%M:%S') }}">
                            {{ comment.created_at.strftime('%m/%d %H:%M') }}
                        </span>
                    </div>
                </div>
                
                <!-- Status indicator -->
                <div style="margin-left: 1em;">
                    {% if comment.is_resolved %}
                    <span style="padding: 0.2em 0.5em; background: rgba(46, 160, 67, 0.2); color: rgba(46, 160, 67, 0.9); border-radius: 3px; font-size: 0.7em;">
                        <i class="fas fa-check-circle" style="margin-right: 0.25em;"></i>Resolved
                    </span>
                    {% else %}
                    <span style="padding: 0.2em 0.5em; background: rgba(241, 196, 15, 0.2); color: rgba(241, 196, 15, 0.9); border-radius: 3px; font-size: 0.7em;">
                        <i class="fas fa-exclamation-circle" style="margin-right: 0.25em;"></i>Open
                    </span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Comment Content -->
            <div style="color: rgba(255, 255, 255, 0.8); line-height: 1.4; margin-bottom: 0.5em;">
                {{ comment.comment_text }}
            </div>
            
            <!-- Actions -->
            <div style="display: flex; gap: 0.5em; padding-top: 0.5em; border-top: 1px solid rgba(255, 255, 255, 0.05);">
                {% if comment.clergy %}
                <button onclick="viewClergy({{ comment.clergy.id }})" 
                        style="padding: 0.3em 0.6em; background: rgba(52, 152, 219, 0.2); border: none; border-radius: 3px; color: rgba(52, 152, 219, 0.9); cursor: pointer; font-size: 0.75em;">
                    <i class="fas fa-eye" style="margin-right: 0.25em;"></i>View
                </button>
                {% endif %}
                
                {% if not comment.is_resolved %}
                <button onclick="resolveComment({{ comment.id }})" 
                        style="padding: 0.3em 0.6em; background: rgba(46, 160, 67, 0.2); border: none; border-radius: 3px; color: rgba(46, 160, 67, 0.9); cursor: pointer; font-size: 0.75em;">
                    <i class="fas fa-check" style="margin-right: 0.25em;"></i>Resolve
                </button>
                {% endif %}
                
                <button onclick="replyToComment({{ comment.id }})" 
                        style="padding: 0.3em 0.6em; background: rgba(255, 255, 255, 0.1); border: none; border-radius: 3px; color: rgba(255, 255, 255, 0.7); cursor: pointer; font-size: 0.75em;">
                    <i class="fas fa-reply" style="margin-right: 0.25em;"></i>Reply
                </button>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if comments.pages > 1 %}
    <div style="margin-top: 1em; padding-top: 0.75em; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: center; gap: 0.5em;">
        {% if comments.has_prev %}
        <button hx-get="/editor/comments?page={{ comments.prev_num }}" 
                hx-target="#comments-content" 
                hx-swap="innerHTML"
                style="padding: 0.25em 0.5em; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 3px; color: rgba(255, 255, 255, 0.8); cursor: pointer; font-size: 0.8em;">
            Previous
        </button>
        {% endif %}
        
        <span style="color: rgba(255, 255, 255, 0.6); font-size: 0.8em; padding: 0.25em 0.5em;">
            Page {{ comments.page }} of {{ comments.pages }}
        </span>
        
        {% if comments.has_next %}
        <button hx-get="/editor/comments?page={{ comments.next_num }}" 
                hx-target="#comments-content" 
                hx-swap="innerHTML"
                style="padding: 0.25em 0.5em; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 3px; color: rgba(255, 255, 255, 0.8); cursor: pointer; font-size: 0.8em;">
            Next
        </button>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div style="text-align: center; padding: 2em; color: rgba(255, 255, 255, 0.5);">
        <i class="fas fa-comments" style="font-size: 2em; opacity: 0.3; margin-bottom: 0.5em;"></i>
        <div>No comments found</div>
    </div>
    {% endif %}
</div>

<script>
// Comment management functions
function viewClergy(clergyId) {
    console.log('View clergy:', clergyId);
    if (typeof window.selectClergy === 'function') {
        window.selectClergy(clergyId);
    }
}

function resolveComment(commentId) {
    console.log('Resolve comment:', commentId);
    if (confirm('Mark this comment as resolved?')) {
        // This would make an HTMX request to resolve the comment
        showNotification('Comment resolution functionality coming soon', 'info');
    }
}

function replyToComment(commentId) {
    console.log('Reply to comment:', commentId);
    showNotification('Comment reply functionality coming soon', 'info');
}

function showNotification(message, type = 'info') {
    console.log(`${type.toUpperCase()}: ${message}`);
}
</script>