<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Clergy Form Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/clergy-form-clean.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .demo-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .demo-controls {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .form-check-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .form-check {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .form-check-input {
            margin: 0;
        }
        .form-check-label {
            margin: 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <div class="container">
            <h1 class="text-center">Clean Clergy Form Demo</h1>
            <p class="text-center mb-0">Comprehensive test of the rebuilt clergy form</p>
        </div>
    </div>
    
    <div class="container">
        <!-- Demo Controls -->
        <div class="demo-controls">
            <h3>Demo Controls</h3>
            <div class="row">
                <div class="col-md-4">
                    <button class="btn btn-primary w-100" onclick="testPrefill()">
                        <i class="fas fa-fill-drip"></i> Test Pre-fill
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-info w-100" onclick="testDynamicBehavior()">
                        <i class="fas fa-cogs"></i> Test Dynamic Behavior
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-secondary w-100" onclick="clearForm()">
                        <i class="fas fa-eraser"></i> Clear Form
                    </button>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <button class="btn btn-success w-100" onclick="testValidation()">
                        <i class="fas fa-check-circle"></i> Test Validation
                    </button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-warning w-100" onclick="testImageUpload()">
                        <i class="fas fa-image"></i> Test Image Upload
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Form Configuration -->
        <script>
        window.ClergyFormConfig = {
            editMode: false,
            clergyData: null,
            ranks: ['Deacon', 'Priest', 'Bishop', 'Archbishop', 'Cardinal', 'Pope'],
            organizations: ['Roman Catholic Church', 'Anglican Church', 'Orthodox Church', 'Episcopal Church'],
            bishops: [
                { id: 1, name: 'Bishop John Smith', rank: 'Bishop', organization: 'Roman Catholic Church' },
                { id: 2, name: 'Archbishop Michael Johnson', rank: 'Archbishop', organization: 'Roman Catholic Church' },
                { id: 3, name: 'Cardinal Robert Brown', rank: 'Cardinal', organization: 'Roman Catholic Church' },
                { id: 4, name: 'Bishop Thomas Wilson', rank: 'Bishop', organization: 'Anglican Church' },
                { id: 5, name: 'Archbishop James Davis', rank: 'Archbishop', organization: 'Orthodox Church' }
            ],
            user: {
                canEdit: true,
                canComment: true
            }
        };
        </script>
        
        <!-- Include the Clean Clergy Form -->
        <div id="clergyFormContainer">
            <!-- The form will be rendered here -->
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="static/js/clergy-form-controller.js"></script>
    <script>
        // Test functions
        function testPrefill() {
            const sampleData = {
                name: "John Cardinal Smith",
                papal_name: "Pope John XXIV",
                rank: "Pope",
                organization: "Roman Catholic Church",
                date_of_birth: "1950-06-15",
                date_of_death: "",
                notes: "This is a test clergy member with comprehensive data.",
                is_deleted: false,
                ordinations: [
                    {
                        id: 1,
                        date: "1975-05-20",
                        is_sub_conditione: false,
                        is_doubtful: false,
                        is_invalid: false,
                        notes: "Ordained to priesthood in Rome",
                        ordaining_bishop: {
                            id: 2,
                            name: "Archbishop Michael Johnson"
                        }
                    },
                    {
                        id: 2,
                        date: "1980-03-15",
                        is_sub_conditione: false,
                        is_doubtful: false,
                        is_invalid: false,
                        notes: "Ordained as bishop",
                        ordaining_bishop: {
                            id: 3,
                            name: "Cardinal Robert Brown"
                        }
                    }
                ],
                consecrations: [
                    {
                        id: 1,
                        date: "1985-03-15",
                        is_sub_conditione: false,
                        is_doubtful: false,
                        is_invalid: false,
                        notes: "Consecrated as bishop",
                        consecrator: {
                            id: 2,
                            name: "Archbishop Michael Johnson"
                        },
                        co_consecrators: [
                            { id: 4, name: "Bishop Thomas Wilson" },
                            { id: 5, name: "Archbishop James Davis" }
                        ]
                    }
                ]
            };
            
            console.log("Testing pre-fill with comprehensive data...");
            window.prefillClergyForm(sampleData);
        }
        
        function testDynamicBehavior() {
            console.log("Testing dynamic form behavior...");
            
            // Test 1: Set to Priest (should show ordination, hide consecration)
            document.getElementById('rank').value = 'Priest';
            clergyFormController.handleRankChange('Priest');
            console.log("Set to Priest - ordination visible, consecration hidden");
            
            setTimeout(() => {
                // Test 2: Set to Bishop (should show both)
                document.getElementById('rank').value = 'Bishop';
                clergyFormController.handleRankChange('Bishop');
                console.log("Set to Bishop - both ordination and consecration visible");
                
                setTimeout(() => {
                    // Test 3: Set to Pope (should show papal name)
                    document.getElementById('rank').value = 'Pope';
                    clergyFormController.handleRankChange('Pope');
                    console.log("Set to Pope - papal name field visible");
                }, 2000);
            }, 2000);
        }
        
        function testValidation() {
            console.log("Testing form validation...");
            
            // Clear the form first
            clearForm();
            
            // Try to submit without required fields
            const form = document.getElementById('clergyForm');
            if (form) {
                form.dispatchEvent(new Event('submit'));
                console.log("Attempted form submission without required fields - should show validation errors");
            }
        }
        
        function testImageUpload() {
            console.log("Testing image upload functionality...");
            
            // Create a test file input
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    console.log("Selected image file:", file.name);
                    clergyFormController.handleImageUpload(e);
                }
            };
            input.click();
        }
        
        function clearForm() {
            console.log("Clearing form...");
            
            // Reset form
            const form = document.getElementById('clergyForm');
            if (form) {
                form.reset();
            }
            
            // Clear dynamic sections
            const ordinationContainer = document.getElementById('ordinationsContainer');
            const consecrationContainer = document.getElementById('consecrationsContainer');
            
            if (ordinationContainer) {
                ordinationContainer.innerHTML = '';
                clergyFormController.state.ordinationCounter = 0;
                clergyFormController.ensureOrdinationSection();
            }
            
            if (consecrationContainer) {
                consecrationContainer.innerHTML = '';
                clergyFormController.state.consecrationCounter = 0;
            }
            
            // Hide papal name field
            const papalNameField = document.getElementById('papalNameField');
            if (papalNameField) {
                papalNameField.style.display = 'none';
            }
            
            // Hide consecration section
            const consecrationSection = document.getElementById('consecrationsSection');
            if (consecrationSection) {
                consecrationSection.style.display = 'none';
            }
            
            // Reset image
            clergyFormController.handleImageRemove();
            
            console.log("Form cleared successfully");
        }
        
        // Auto-render the form when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Render the clean form HTML
            const container = document.getElementById('clergyFormContainer');
            container.innerHTML = `
                <div class="clergy-form-container">
                    <div class="clergy-form-card">
                        <div class="clergy-form-header">
                            <h2 class="clergy-form-title">Add New Clergy</h2>
                        </div>
                        
                        <div class="clergy-form-body">
                            <form id="clergyForm" class="clergy-form" method="POST" action="#" enctype="multipart/form-data">
                                <!-- Form Layout -->
                                <div class="form-layout">
                                    <!-- Photo Section -->
                                    <div class="photo-section">
                                        <label class="form-label">Photo</label>
                                        <div class="image-upload-area" id="imageUploadArea">
                                            <div class="image-preview" id="imagePreview">
                                                <div class="image-placeholder">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                            </div>
                                            <div class="image-controls">
                                                <input type="file" id="imageInput" name="clergy_image" accept="image/*" style="display: none;">
                                                <button type="button" class="btn btn-upload" id="uploadBtn" title="Upload Image">
                                                    <i class="fas fa-upload"></i>
                                                </button>
                                                <button type="button" class="btn btn-crop" id="cropBtn" title="Edit Image" style="display: none;">
                                                    <i class="fas fa-crop"></i>
                                                </button>
                                                <button type="button" class="btn btn-remove" id="removeBtn" title="Remove Image" style="display: none;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Form Fields -->
                                    <div class="form-fields">
                                        <!-- Basic Information -->
                                        <div class="form-section">
                                            <h3 class="section-title">Basic Information</h3>
                                            
                                            <div class="form-grid">
                                                <div class="form-field">
                                                    <label for="name" class="form-label required">Full Name</label>
                                                    <input type="text" id="name" name="name" class="form-control" required>
                                                </div>
                                                
                                                <div class="form-field" id="papalNameField" style="display: none;">
                                                    <label for="papal_name" class="form-label">Papal Name</label>
                                                    <input type="text" id="papal_name" name="papal_name" class="form-control" placeholder="e.g., Pope Francis">
                                                </div>
                                                
                                                <div class="form-field">
                                                    <label for="rank" class="form-label required">Rank</label>
                                                    <select id="rank" name="rank" class="form-control" required>
                                                        <option value="">Select Rank</option>
                                                        <option value="Deacon">Deacon</option>
                                                        <option value="Priest">Priest</option>
                                                        <option value="Bishop">Bishop</option>
                                                        <option value="Archbishop">Archbishop</option>
                                                        <option value="Cardinal">Cardinal</option>
                                                        <option value="Pope">Pope</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="form-field">
                                                    <label for="organization" class="form-label">Organization</label>
                                                    <select id="organization" name="organization" class="form-control">
                                                        <option value="">Select Organization</option>
                                                        <option value="Roman Catholic Church">Roman Catholic Church</option>
                                                        <option value="Anglican Church">Anglican Church</option>
                                                        <option value="Orthodox Church">Orthodox Church</option>
                                                        <option value="Episcopal Church">Episcopal Church</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="form-field">
                                                    <label for="date_of_birth" class="form-label">Date of Birth</label>
                                                    <input type="date" id="date_of_birth" name="date_of_birth" class="form-control">
                                                </div>
                                                
                                                <div class="form-field">
                                                    <label for="date_of_death" class="form-label">Date of Death</label>
                                                    <input type="date" id="date_of_death" name="date_of_death" class="form-control">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Ordinations Section (Always Visible) -->
                                        <div class="form-section" id="ordinationsSection">
                                            <div class="section-header">
                                                <h3 class="section-title">Ordinations <span class="required-indicator">*</span></h3>
                                                <div class="section-controls">
                                                    <button type="button" class="btn btn-primary btn-sm" id="addOrdinationBtn">
                                                        <i class="fas fa-plus"></i> Add Ordination
                                                    </button>
                                                    <button type="button" class="btn btn-danger btn-sm" id="clearOrdinationsBtn" title="Clear all ordinations">
                                                        <i class="fas fa-trash"></i> Clear All
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="section-help">
                                                <i class="fas fa-info-circle"></i> Every clergy member must have at least one ordination.
                                            </div>
                                            <div id="ordinationsContainer" class="dynamic-sections">
                                                <!-- Dynamic ordination sections will be added here -->
                                            </div>
                                        </div>
                                        
                                        <!-- Consecrations Section (Conditional) -->
                                        <div class="form-section" id="consecrationsSection" style="display: none;">
                                            <div class="section-header">
                                                <h3 class="section-title">Consecrations</h3>
                                                <div class="section-controls">
                                                    <button type="button" class="btn btn-primary btn-sm" id="addConsecrationBtn">
                                                        <i class="fas fa-plus"></i> Add Consecration
                                                    </button>
                                                    <button type="button" class="btn btn-danger btn-sm" id="clearConsecrationsBtn" title="Clear all consecrations">
                                                        <i class="fas fa-trash"></i> Clear All
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="section-help">
                                                <i class="fas fa-info-circle"></i> Consecration is required for bishops, archbishops, cardinals, and popes.
                                            </div>
                                            <div id="consecrationsContainer" class="dynamic-sections">
                                                <!-- Dynamic consecration sections will be added here -->
                                            </div>
                                        </div>
                                        
                                        <!-- Notes Section -->
                                        <div class="form-section">
                                            <div class="form-field">
                                                <label for="notes" class="form-label">Notes</label>
                                                <textarea id="notes" name="notes" class="form-control" rows="4" placeholder="Additional information about this clergy member..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Form Actions -->
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-save"></i> Save Clergy Record
                                    </button>
                                    <a href="#" class="btn btn-secondary btn-lg">
                                        Cancel
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        });
    </script>
</body>
</html>
